
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Monitoring &#8212; OpenMLDB  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Operations in CLI" href="cli.html" />
    <link rel="prev" title="Backup and Restore" href="backup.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/openmldb_logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about/index.html">
   About
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../about/intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../about/milestones.html">
     Milestones
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../about/release_notes.html">
     Release Notes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../quickstart/index.html">
   Quickstart
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/openmldb_quickstart.html">
     OpenMLDB Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/java_sdk.html">
     Java SDK Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/python_sdk.html">
     Python SDK Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/rest_api.html">
     REST APIs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorial/index.html">
   Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorial/standalone_vs_cluster.html">
     Cluster vs. Standalone Versions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorial/tutorial_sql_1.html">
     SQL for Feature Extraction (Part 1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorial/tutorial_sql_2.html">
     SQL for Feature Extraction (Part 2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorial/data_import.html">
     Data Import
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../use_case/index.html">
   Use Cases
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../use_case/pulsar_connector_demo.html">
     Integration with Pulsar
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../use_case/kafka_connector_demo.html">
     OpenMLDB Kafka Connector：Connecting Real-Time Data Streams
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../deploy/index.html">
   Deployment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/compile.html">
     Build
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/install_deploy.html">
     Install and Deploy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/conf.html">
     Configuration File
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Maintenance
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="upgrade.html">
     Upgrade
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="backup.html">
     Backup and Restore
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Monitoring
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cli.html">
     Operations in CLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="faq.html">
     Operation and Maintenance FAQ
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../developer/index.html">
   Developers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../developer/built_in_function_develop_guide.html">
     Built-In Function Development
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav>
</br>
Current Version: v0.5</br>
Versions：
<ul>
  <li><a href="../../main/index.html">main</a></li>
  <li><a href="monitoring.html">v0.5</a></li>
  <li><a href="../../v0.4/index.html">v0.4</a></li>
  <li><a href="../../v0.6/index.html">v0.6</a></li>
</ul>
</br>
</div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/maintain/monitoring.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-and-run-openmldb-exporter">
   Install and Run OpenMLDB Exporter
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#environmental-requirements">
     Environmental Requirements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preparation">
     Preparation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deploy-the-openmldb-exporter">
     Deploy the OpenMLDB exporter
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploy-node-exporter">
   Deploy Node Exporter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploy-prometheus-and-grafana">
   Deploy Prometheus and Grafana
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#understand-existing-monitoring-metrics">
   Understand Existing Monitoring Metrics
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Monitoring</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-and-run-openmldb-exporter">
   Install and Run OpenMLDB Exporter
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#environmental-requirements">
     Environmental Requirements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preparation">
     Preparation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deploy-the-openmldb-exporter">
     Deploy the OpenMLDB exporter
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploy-node-exporter">
   Deploy Node Exporter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploy-prometheus-and-grafana">
   Deploy Prometheus and Grafana
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#understand-existing-monitoring-metrics">
   Understand Existing Monitoring Metrics
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="monitoring">
<h1>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>The monitoring scheme of OpenMLDB is outlined as follows：</p>
<ul class="simple">
<li><p>Use <a class="reference external" href="https://prometheus.io">prometheus</a> to collect monitoring metrics, <a class="reference external" href="https://grafana.com/oss/grafana/">grafana</a> to visualize metrics</p></li>
<li><p>OpenMLDB exporter exposes database-level and component-level monitoring metrics</p></li>
<li><p>Node uses <a class="reference external" href="https://github.com/prometheus/node_exporter">node_exporter</a> to expose machine and operating system related metrics</p></li>
</ul>
</section>
<section id="install-and-run-openmldb-exporter">
<h2>Install and Run OpenMLDB Exporter<a class="headerlink" href="#install-and-run-openmldb-exporter" title="Permalink to this headline">#</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://pypi.org/project/openmldb-exporter/"><img alt="PyPI" src="https://img.shields.io/pypi/v/openmldb-exporter?label=openmldb-exporter" /></a>
<img alt="PyPI - Python Version" src="https://img.shields.io/pypi/pyversions/openmldb-exporter?style=flat-square" /></p>
<p>The OpenMLDB exporter is a prometheus exporter implemented in Python. The core connects the OpenMLDB instance through the database SDK and will query the exposed monitoring indicators through SQL statements. Exporter will follow the OpenMLDB version update and release to PyPI. For production use, you can install the latest <code class="docutils literal notranslate"><span class="pre">openmldb-exporter</span></code> directly through pip. For development and usage instructions, please refer to the code directory <a class="reference external" href="https://github.com/4paradigm/OpenMLDB/tree/main/monitoring">README</a>.</p>
</section>
<section id="environmental-requirements">
<h3>Environmental Requirements<a class="headerlink" href="#environmental-requirements" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Python &gt;= 3.8</p></li>
<li><p>OpenMLDB &gt;= 0.5.0</p></li>
</ul>
</section>
<section id="preparation">
<h3>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">#</a></h3>
<ol class="arabic">
<li><p>Get OpenMLDB</p>
<p>You can download precompiled packages from the <a class="reference external" href="https://github.com/4paradigm/OpenMLDB/releases">OpenMLDB release</a> page, or build from source.</p>
<p>Note that when compiling, make sure to enable the compile option: <code class="docutils literal notranslate"><span class="pre">-DTCMALLOC_ENABLE=ON</span></code>, the default is <code class="docutils literal notranslate"><span class="pre">ON</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/4paradigm/OpenMLDB
<span class="nb">cd</span> OpenMLDB
<span class="c1"># OpenMLDB exporter depends on compiled Python SDK</span>
make <span class="nv">SQL_PYSDK_ENABLE</span><span class="o">=</span>ON
make install
</pre></div>
</div>
<p>See <a class="reference internal" href="../deploy/compile.html"><span class="doc std std-doc">compile.md</span></a>.</p>
</li>
<li><p>Start OpenMLDB</p>
<p>See <a class="reference internal" href="../deploy/install_deploy.html"><span class="doc std std-doc">install_deploy</span></a> How to start OpenMLDB components</p>
<p>OpenMLDB exporter requires OpenMLDB to start the server status function, to do so, add the startup parameter <code class="docutils literal notranslate"><span class="pre">--enable_status_service=true</span></code> at startup, please make sure that <code class="docutils literal notranslate"><span class="pre">--enable_status_service=true'</span> <span class="pre">in</span> </code>conf/(tablet|nameserver).flags<code class="docutils literal notranslate"><span class="pre">in</span> <span class="pre">the</span> <span class="pre">installation</span> <span class="pre">directory</span></code>.</p>
<p>The default startup script <code class="docutils literal notranslate"><span class="pre">bin/start.sh</span></code> enables server status, no additional configuration is required.</p>
</li>
<li><p>Note: Make sure to select the binding IP addresses of OpenMLDB components OpenMLDB exporter as well as prometheus and grafana to ensure that grafana can access prometheus, and that prometheus, OpenMLDB exporter, and OpenMLDB components can access each other.</p></li>
</ol>
</section>
<section id="deploy-the-openmldb-exporter">
<h3>Deploy the OpenMLDB exporter<a class="headerlink" href="#deploy-the-openmldb-exporter" title="Permalink to this headline">#</a></h3>
<ol class="arabic">
<li><p>Install openmldb-exporter from PyPi</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install openmldb-exporter<span class="o">==</span><span class="m">0</span>.5.0
</pre></div>
</div>
</li>
<li><p>Run</p>
<p>An executable <code class="docutils literal notranslate"><span class="pre">openmldb-exporter</span></code> will be installed by default, make sure pip install path is in your $PATH environment variable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openmldb-exporter
</pre></div>
</div>
<p>Note that the appropriate parameters are passed in, <code class="docutils literal notranslate"><span class="pre">openmldb-exporter</span> <span class="pre">-h</span></code> to see help:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   usage: openmldb-exporter <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--log.level LOG.LEVEL<span class="o">]</span> <span class="o">[</span>--web.listen-address WEB.LISTEN_ADDRESS<span class="o">]</span>
                            <span class="o">[</span>--web.telemetry-path WEB.TELEMETRY_PATH<span class="o">]</span> <span class="o">[</span>--config.zk_root CONFIG.ZK_ROOT<span class="o">]</span>
                            <span class="o">[</span>--config.zk_path CONFIG.ZK_PATH<span class="o">]</span> <span class="o">[</span>--config.interval CONFIG.INTERVAL<span class="o">]</span>
   
   OpenMLDB exporter
   
   optional arguments:
     -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
     --log.level LOG.LEVEL
                           config log level, default WARN
     --web.listen-address WEB.LISTEN_ADDRESS
                           process listen port, default <span class="m">8000</span>
     --web.telemetry-path WEB.TELEMETRY_PATH
                           Path under which to expose metrics, default metrics
     --config.zk_root CONFIG.ZK_ROOT
                           endpoint to zookeeper, default <span class="m">127</span>.0.0.1:6181
     --config.zk_path CONFIG.ZK_PATH
                           root path <span class="k">in</span> zookeeper <span class="k">for</span> OpenMLDB, default /
     --config.interval CONFIG.INTERVAL
                           interval <span class="k">in</span> seconds to pull metrics periodically, default <span class="m">30</span>.0
</pre></div>
</div>
</li>
<li><p>View the list of metrics</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   $ curl http://127.0.0.1:8000/metrics
   <span class="c1"># HELP openmldb_connected_seconds_total duration for a component conncted time in seconds                              </span>
   <span class="c1"># TYPE openmldb_connected_seconds_total counter                                                                        </span>
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9520&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">208834</span>.70900011063                         
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9521&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">208834</span>.70700001717                         
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9522&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">208834</span>.71399998665                         
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9622&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">208833</span>.70000004768                     
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9623&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">208831</span>.70900011063                     
   openmldb_connected_seconds_total<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9624&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">208829</span>.7230000496                      
   <span class="c1"># HELP openmldb_connected_seconds_created duration for a component conncted time in seconds                            </span>
   <span class="c1"># TYPE openmldb_connected_seconds_created gauge                                                                        </span>
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9520&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">1</span>.6501813860467942e+09                   
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9521&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">1</span>.6501813860495396e+09                   
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9522&quot;</span>,role<span class="o">=</span><span class="s2">&quot;tablet&quot;</span><span class="o">}</span> <span class="m">1</span>.650181386050323e+09                    
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9622&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">1</span>.6501813860512116e+09               
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9623&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">1</span>.650181386051238e+09                
   openmldb_connected_seconds_created<span class="o">{</span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;172.17.0.15:9624&quot;</span>,role<span class="o">=</span><span class="s2">&quot;nameserver&quot;</span><span class="o">}</span> <span class="m">1</span>.6501813860512598e+09               
   
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="deploy-node-exporter">
<h2>Deploy Node Exporter<a class="headerlink" href="#deploy-node-exporter" title="Permalink to this headline">#</a></h2>
<p>For how to install and deploy prometheus, grafana, please refer to the official documents <a class="reference external" href="https://prometheus.io/docs/prometheus/latest/getting_started/">promtheus get started</a> and [grafana get started](<a class="reference external" href="https://grafana.com/docs/">https://grafana.com/docs/</a> grafana/latest/getting-started/getting-started-prometheus/) .</p>
<p><a class="reference external" href="https://github.com/prometheus/node_exporter">node_exporter</a> is an official implementation of prometheus that exposes system metrics.</p>
<p>Go to the <a class="reference external" href="https://github.com/prometheus/node_exporter/releases">release</a> page, download and unzip the compressed package of the corresponding platform. For example, under linux amd64 platform:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl -SLO https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.darwin-amd64.tar.gz
tar xzf node_exporter-1.3.1-*.tar.gz
<span class="nb">cd</span> node_exporter-1.3.1-*/

<span class="c1"># Start node_exporter</span>
./node_exporter
</pre></div>
</div>
</section>
<section id="deploy-prometheus-and-grafana">
<h2>Deploy Prometheus and Grafana<a class="headerlink" href="#deploy-prometheus-and-grafana" title="Permalink to this headline">#</a></h2>
<p>For installation and deployment of prometheus and grafana, please refer to the official documents <a class="reference external" href="https://prometheus.io/docs/prometheus/latest/getting_started/">promtheus get started</a> and [grafana get started](<a class="reference external" href="https://grafana.com/docs/">https://grafana.com/docs/</a> grafana/latest/getting-started/getting-started-prometheus/).
OpenMLDB provides prometheus and grafana configuration files for reference, see <a class="reference external" href="https://github.com/4paradigm/OpenMLDB/tree/main/monitoring/openmldb_mixin/README.md">OpenMLDB mixin</a></p>
<ul class="simple">
<li><p>prometheus_example.yml: Prometheus configuration example, intended to modify the target address in <code class="docutils literal notranslate"><span class="pre">node</span></code>, <code class="docutils literal notranslate"><span class="pre">openmldb_components</span></code> and <code class="docutils literal notranslate"><span class="pre">openmldb_exporter</span></code> jobs</p></li>
<li><p>openmldb_dashboard.json: grafana dashboard configuration for OpenMLDB metrics, divided into two steps:</p>
<ol class="arabic simple">
<li><p>Under the grafana data source page, add the started prometheus server address as the data source</p></li>
<li><p>Under the dashboard browsing page, click New to import a dashboard, and upload the json configuration file</p></li>
</ol>
</li>
</ul>
</section>
<section id="understand-existing-monitoring-metrics">
<h2>Understand Existing Monitoring Metrics<a class="headerlink" href="#understand-existing-monitoring-metrics" title="Permalink to this headline">#</a></h2>
<p>Taking the OpenMLDB cluster system as an example, the monitoring indicators are divided into two categories according to different prometheus pull jobs:</p>
<ol class="arabic">
<li><p>DB-Level metrics, exposed through the OpenMLDB exporter, correspond to the <code class="docutils literal notranslate"><span class="pre">job_name=openmldb_exporter</span></code> entry in the <code class="docutils literal notranslate"><span class="pre">prometheus_example.yml</span></code> configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openmldb_exporter</span><span class="w"></span>
<span class="w">    </span><span class="c1"># pull OpenMLDB DB-Level specific metric</span><span class="w"></span>
<span class="w">    </span><span class="c1"># change the &#39;targets&#39; value to your deployed OpenMLDB exporter endpoint</span><span class="w"></span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.17.0.15:8000</span><span class="w"></span>
</pre></div>
</div>
<p>The categories of indicators exposed are mainly:</p>
<ul class="simple">
<li><p>component status: cluster component status</p></li>
<li><p>table status: database table related information, such as <code class="docutils literal notranslate"><span class="pre">rows_cout</span></code>, <code class="docutils literal notranslate"><span class="pre">memory_bytes</span></code></p></li>
<li><p>deploy query response time: the runtime of the deployment query inside the tablet</p></li>
</ul>
<p>The full DB-Level metrics can be listed through the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl http://172.17.0.15:8000/metrics
</pre></div>
</div>
</li>
<li><p>Component-Level metrics. The related components of OpenMLDB (nameserver, tablet, etc), themselves as BRPC server, and expose [prometheus related metrics](<a class="reference external" href="https://github.com/apache/incubator-brpc/blob/master/docs/en/bvar">https://github.com/apache/incubator-brpc/blob/master/docs/en/bvar</a> .md#export-to-prometheus), you only need to configure the prometheus server to pull metrics from the corresponding address. It corresponds to the <code class="docutils literal notranslate"><span class="pre">job_name=openmldb_components</span></code> item in <code class="docutils literal notranslate"><span class="pre">prometheus_example.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openmldb_components</span><span class="w"></span>
<span class="w">    </span><span class="c1"># job to pull component metrics from OpenMLDB like tablet/nameserver</span><span class="w"></span>
<span class="w">    </span><span class="c1"># tweak the &#39;targets&#39; list in &#39;static_configs&#39; on your need</span><span class="w"></span>
<span class="w">    </span><span class="c1"># every nameserver/tablet component endpoint should be added into targets</span><span class="w"></span>
<span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/brpc_metrics</span><span class="w"></span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.17.0.15:9622</span><span class="w"></span>
</pre></div>
</div>
<p>The metrics of exposure are mainly</p>
<ul class="simple">
<li><p>BRPC server process related information</p></li>
<li><p>Corresponding to the RPC method related metrics defined by the BRPC server, such as the RPC request <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">error_count</span></code>, <code class="docutils literal notranslate"><span class="pre">qps</span></code> and <code class="docutils literal notranslate"><span class="pre">response_time</span></code></p></li>
</ul>
<p>Metrics and help information can be shown through the following command (Note that the metrics exposed by different components will vary):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl http://<span class="si">${</span><span class="nv">COMPONENT_IP</span><span class="si">}</span>:<span class="si">${</span><span class="nv">COMPONENT_PORT</span><span class="si">}</span>/brpc_metrics
</pre></div>
</div>
</li>
</ol>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="backup.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Backup and Restore</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="cli.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Operations in CLI</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By OpenMLDB<br/>
  
      &copy; Copyright 2022, OpenMLDB.<br/>
    Last updated on Aug 27, 2022, 3:54:43 PM.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>