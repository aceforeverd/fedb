
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Guidelines for Feature Engineering Development (Part 1) &#8212; OpenMLDB  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Guidelines for Feature Engineering Development (Part 2)" href="tutorial_sql_2.html" />
    <link rel="prev" title="Cluster vs. Standalone Versions" href="standalone_vs_cluster.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/openmldb_logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about/index.html">
   About
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../about/milestones.html">
     History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../about/release_notes.html">
     v0.4.x Release Notes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../quickstart/index.html">
   Quickstart
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/openmldb_quickstart.html">
     OpenMLDB Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/java_sdk.html">
     Java SDK Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/python_sdk.html">
     Python SDK Quickstart
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../quickstart/rest_api.html">
     REST APIs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="standalone_vs_cluster.html">
     Cluster vs. Standalone Versions
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Guidelines for Feature Engineering Development (Part 1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial_sql_2.html">
     Guidelines for Feature Engineering Development (Part 2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data_import.html">
     Data Import
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../deploy/index.html">
   Deployment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/compile.html">
     Build
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/install_deploy.html">
     Install and Deploy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../deploy/conf.html">
     Configuration File
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../maintain/index.html">
   Maintenance
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../maintain/cli.html">
     Operations in CLI
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../developer/index.html">
   Developers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../developer/built_in_function_develop_guide.html">
     Built-In Function Development
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav>
</br>
Current Version: v0.4</br>
Versions：
<ul>
  <li><a href="../../main/index.html">main</a></li>
  <li><a href="../../v0.5/index.html">v0.5</a></li>
  <li><a href="tutorial_sql_1.html">v0.4</a></li>
  <li><a href="../../v0.6/index.html">v0.6</a></li>
</ul>
</br>
</div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorial/tutorial_sql_1.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-the-feature-engineering-of-machine-learning">
   1. What is the feature engineering of machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering-development-tool-openmldb">
   2. Feature Engineering Development Tool – OpenMLDB
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-0-to-1-feature-engineering-practice">
   3. From 0 to 1, Feature Engineering Practice
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#primary-and-secondary-tables">
     3.1.1. Primary and Secondary Tables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#types-of-features">
     3.1.2. Types of Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-features-of-the-main-table-single-line">
     3.2. The Features of the Main Table Single Line
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-series-features-of-main-table-window">
     3.3. Time-Series Features of Main Table Window
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-define-timing-window">
     3.3.1. Step 1: Define Timing Window
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-multi-line-aggregate-function-processing">
     3.3.2. Step 2: Multi-line Aggregate Function Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-reading-and-the-next-preview">
   4. Extended Reading and the Next Preview
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Guidelines for Feature Engineering Development (Part 1)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-the-feature-engineering-of-machine-learning">
   1. What is the feature engineering of machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering-development-tool-openmldb">
   2. Feature Engineering Development Tool – OpenMLDB
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-0-to-1-feature-engineering-practice">
   3. From 0 to 1, Feature Engineering Practice
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#primary-and-secondary-tables">
     3.1.1. Primary and Secondary Tables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#types-of-features">
     3.1.2. Types of Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-features-of-the-main-table-single-line">
     3.2. The Features of the Main Table Single Line
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-series-features-of-main-table-window">
     3.3. Time-Series Features of Main Table Window
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-define-timing-window">
     3.3.1. Step 1: Define Timing Window
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-multi-line-aggregate-function-processing">
     3.3.2. Step 2: Multi-line Aggregate Function Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-reading-and-the-next-preview">
   4. Extended Reading and the Next Preview
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="guidelines-for-feature-engineering-development-part-1">
<h1>Guidelines for Feature Engineering Development (Part 1)<a class="headerlink" href="#guidelines-for-feature-engineering-development-part-1" title="Permalink to this headline">#</a></h1>
<section id="what-is-the-feature-engineering-of-machine-learning">
<h2>1. What is the feature engineering of machine learning<a class="headerlink" href="#what-is-the-feature-engineering-of-machine-learning" title="Permalink to this headline">#</a></h2>
<p>A machine learning application in a real scene generally includes two main processes, namely <strong>Feature Engineering</strong> and <strong>Machine Learning Model</strong> (hereinafter referred to as <strong>Model</strong>). We must know a lot about the model and have the most contact at ordinary times. For example, from the classic logical regression and decision tree model to the deep learning model of the fire in recent years, we all focus on how to develop high-quality models. We may pay less attention to engineering features. However, you must have heard a famous saying that data and features determine the upper limit of machine learning, while models and algorithms only approach this upper limit. It can be seen that we have long agreed on the importance of Feature Engineering.</p>
<p>In one sentence, Feature Engineering is defined: Use specific domain knowledge to extract useful feature information from the original data. It emphasizes domain knowledge, that is to say, feature extraction is not a standardized process, but has different experience and methodology based on different scenarios. For a simple example, for the real-time recommendation system, the original data may only be the search keywords entered by users in real time, such as “washing machine”, and the corresponding user and commodity data tables stored in the database. In order to make better real-time recommendation, the following more meaningful features can be considered:</p>
<ul class="simple">
<li><p>The home appliance brand that the user purchased the most in the past year</p></li>
<li><p>The average consumption level of the user in the past three years</p></li>
<li><p>In the past hour, the discount on the platform has been more than 70%, which is in line with the top three washing machine models purchased by users in this user gender and age group</p></li>
</ul>
<p>As can be seen from the above example, features can be made quite complex and can have very high timeliness. So how to extract good features according to specific scenes is what data scientists need. At the same time, they need to be equipped with powerful tools to do Feature Engineering well. This tutorial will introduce you to how to do Feature Engineering in practice.</p>
</section>
<section id="feature-engineering-development-tool-openmldb">
<h2>2. Feature Engineering Development Tool – OpenMLDB<a class="headerlink" href="#feature-engineering-development-tool-openmldb" title="Permalink to this headline">#</a></h2>
<p>Before introducing the Feature Engineering algorithm, it is necessary to understand the development and deployment tools of Feature Engineering. According to experience, we roughly classify them and summarize their advantages and disadvantages.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Development Tool</p></th>
<th class="head"><p>Entry Threshold</p></th>
<th class="head"><p>Functional Support</p></th>
<th class="head"><p>Engineering Landing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Python</p></td>
<td><p>Low; Data is widely used by scientists</p></td>
<td><p>The function realization is relatively free. Through python programming, you can basically realize any operation script</p></td>
<td><p>More difficult. Python programs are generally inefficient and can be developed offline, but their performance generally can not meet the requirements of online real-time computing. In addition, users need to solve production-level features such as high availability.</p></td>
</tr>
<tr class="row-odd"><td><p>General Database</p></td>
<td><p>Medium, Development based on SQL</p></td>
<td><p>There is no optimization for Feature Engineering, the implementation of some features is awkward, or the operation efficiency is low after implementation.</p></td>
<td><p>Acceptable. However, the function or performance of feature calculation functions that support less friendly features may not meet the needs of production environment.</p></td>
</tr>
<tr class="row-even"><td><p>Hybrid Development, such as Offline Python, Online Database or C++</p></td>
<td><p>It is very high and requires two skill stack teams to develop and maintain</p></td>
<td><p>Through development and customization, the functional requirements can be met.</p></td>
<td><p>Acceptable but costly. In addition to the development and operation cost, it is also necessary to solve the problem of online and offline consistency to ensure the consistency of offline and online effects.</p></td>
</tr>
<tr class="row-odd"><td><p>OpenMLDB</p></td>
<td><p>Medium, Development based on SQL</p></td>
<td><p>For Feature Engineering optimization, it is extended based on standard SQL to efficiently support the common calculation methods of Feature Engineering</p></td>
<td><p>Low cost and efficient landing. Based on SQL development, the online development is realized, which naturally solves the problems of performance and online and offline consistency.</p></td>
</tr>
</tbody>
</table>
<p>From the above table, we can see that openmldb has unique advantages in function and engineering landing. Especially for the calculation of timing characteristics with high real-time performance, openmldb has a lot of targeted optimization. If you want to learn more about openmldb, you can read the relevant <a class="reference external" href="https://zhuanlan.zhihu.com/p/462559609">introduction document</a>, and <a class="reference external" href="https://github.com/4paradigm/OpenMLDB">GitHub repo of OpenMLDB</a>.</p>
<p>In this series of tutorials, we will demonstrate how to develop Feature Engineering scripts based on SQL syntax of openmldb. You can get started quickly by reading our document - <a class="reference external" href="http://docs-cn.openmldb.ai/2620852">OpenMLDB</a>, to learn how to try out openmldb (based on docker image, it is recommended to try it quickly through stand-alone version); You can also find our <a class="reference external" href="http://docs-cn.openmldb.ai/">complete product description document</a> here.</p>
</section>
<section id="from-0-to-1-feature-engineering-practice">
<h2>3. From 0 to 1, Feature Engineering Practice<a class="headerlink" href="#from-0-to-1-feature-engineering-practice" title="Permalink to this headline">#</a></h2>
<p>We will introduce the common processing methods of Feature Engineering in two parts. This part will focus on single table feature processing, and the next part will focus on more complex multi-table feature computing. This paper uses the anti-fraud commonly used in the financial field as an actual case to describe.</p>
<p>Note that if you want to run the SQL illustrated in this tutorial, please follow the following two steps to prepare：</p>
<ul class="simple">
<li><p>It is recommended to use docker image to run this tutorial under <strong>Stand-alone Version</strong>. Refer to <a class="reference external" href="http://docs-cn.openmldb.ai/2620852">OpenMLDB Quick Start</a> for image pull and CLI operation mode If using the clustered version, please use the offline mode（<code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">&#64;&#64;execute_mode='offline'</span></code> ）. The normal online mode under the clustered CLI only supports the simple data preview function, so most of the SQL in the tutorial cannot be run.</p></li>
<li><p>All data related to this tutorial and the import operation script can be downloaded <a class="reference external" href="https://openmldb.ai/download/tutorial_sql/tutoral_sql_data.zip">here</a></p></li>
</ul>
<section id="primary-and-secondary-tables">
<h3>3.1.1. Primary and Secondary Tables<a class="headerlink" href="#primary-and-secondary-tables" title="Permalink to this headline">#</a></h3>
<p><strong>Main Table</strong> is the main data table of feature extraction. Intuitively, it can be understood that the main table is a data table with label columns required for model training. In the process of Feature Engineering, feature calculation will be performed on each row of the main table to finally generate the corresponding <strong>Feature Width Table</strong>. For example, the following user transaction table (hereinafter referred to as data table t1) is the main table of the case described in this paper.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
<td><p>Sample ID, each sample has a unique ID</p></td>
</tr>
<tr class="row-odd"><td><p>uid</p></td>
<td><p>STRING</p></td>
<td><p>User ID</p></td>
</tr>
<tr class="row-even"><td><p>mid</p></td>
<td><p>STRING</p></td>
<td><p>Merchant ID</p></td>
</tr>
<tr class="row-odd"><td><p>cardno</p></td>
<td><p>STRING</p></td>
<td><p>Card Number</p></td>
</tr>
<tr class="row-even"><td><p>trans_time</p></td>
<td><p>TIMESTAMP</p></td>
<td><p>Transaction Time</p></td>
</tr>
<tr class="row-odd"><td><p>trans_amt</p></td>
<td><p>DOUBLE</p></td>
<td><p>Transaction Amount</p></td>
</tr>
<tr class="row-even"><td><p>trans_type</p></td>
<td><p>STRING</p></td>
<td><p>Transaction Type</p></td>
</tr>
<tr class="row-odd"><td><p>province</p></td>
<td><p>STRING</p></td>
<td><p>Province</p></td>
</tr>
<tr class="row-even"><td><p>city</p></td>
<td><p>STRING</p></td>
<td><p>City</p></td>
</tr>
<tr class="row-odd"><td><p>label</p></td>
<td><p>BOOL</p></td>
<td><p>Sample label, true|false</p></td>
</tr>
</tbody>
</table>
<p>In addition to the main table, there may also be data tables in the database that store relevant auxiliary information, which can be spliced with the main table through the join operation. These tables are called <strong>Secondary Tables</strong> (note that there may be multiple secondary tables). For example, we can have a secondary table to store the merchant flow history. In the process of Feature Engineering, more valuable information can be obtained by splicing the information of main table and sub-standard. The Feature Engineering of multi-table will be introduced in detail in the next part of this series.</p>
</section>
<section id="types-of-features">
<h3>3.1.2. Types of Features<a class="headerlink" href="#types-of-features" title="Permalink to this headline">#</a></h3>
<p>Before discussing the details of feature construction in depth, we need to classify the features commonly used in machine learning. From the perspective of building feature data sets and aggregation methods, there are four common features in machine learning:</p>
<ul class="simple">
<li><p>Single line feature of the main table: Processing and calculating expressions and functions for one or more columns of the main table.</p></li>
<li><p>Timing characteristics of main table window: Build a timing window for the main table and process the timing characteristics in the window.</p></li>
<li><p>Single line feature of sub table: The current main table row matches a record from the sub table and splices it, and then processes the single line feature of the spliced data row.</p></li>
<li><p>Multi-row aggregation feature of sub table: The current main table row matches multiple records from the sub table and performs feature processing on multiple records.</p></li>
</ul>
<p>The first part of this paper will focus on the single line characteristics of the main table and the time sequence characteristics of the main table window. The next part will specifically introduce the single line characteristics of the sub table and the multi-line aggregation characteristics of the sub table.</p>
</section>
<section id="the-features-of-the-main-table-single-line">
<h3>3.2. The Features of the Main Table Single Line<a class="headerlink" href="#the-features-of-the-main-table-single-line" title="Permalink to this headline">#</a></h3>
<p>Perform expression and function processing calculation on one or more columns of the current main table row. It mainly includes the following ways.</p>
<p><strong>In-line Extraction</strong></p>
<p>Some columns of the main table can be directly used as features to participate in model training.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Multi-row Machining</strong></p>
<p>Several columns of the main table can be processed into a feature through expressions or functions. For example, the following example splices province and city into a string as a feature.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">province_city</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Single Line Function Processing</strong></p>
<p>Calculate and process through the built-in function of the system or UDF. For example, days, hours and minutes are extracted as features.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="k">day</span><span class="p">(</span><span class="n">trans_time</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f_trans_day</span><span class="p">,</span><span class="w"> </span>
<span class="n">hour</span><span class="p">(</span><span class="n">trans_time</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f_trans_hour</span><span class="p">,</span><span class="w"> </span>
<span class="k">minute</span><span class="p">(</span><span class="n">trans_time</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f_trans_minute</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Other related functions also include numerical feature calculation (such as ‘ceiling’) and string feature calculation (such as ‘substr’).</p>
</section>
<section id="time-series-features-of-main-table-window">
<h3>3.3. Time-Series Features of Main Table Window<a class="headerlink" href="#time-series-features-of-main-table-window" title="Permalink to this headline">#</a></h3>
<p>In many scenarios, the more commonly used feature construction method is based on the feature construction of time window. For example, transaction data and user behavior are time-series data with time stamp. Two steps need to be completed to construct the timing characteristics of the main table window:</p>
<ul class="simple">
<li><p>Step 1: Define Timing Window</p></li>
<li><p>Step 2: Construct Features on the Timing Window</p></li>
</ul>
</section>
<section id="step-1-define-timing-window">
<h3>3.3.1. Step 1: Define Timing Window<a class="headerlink" href="#step-1-define-timing-window" title="Permalink to this headline">#</a></h3>
<p>We can define a specific timing window size either through the time interval (such as a month) or through the number of lines in the window (such as 100). The most basic definition of timing window:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>window window_name as (PARTITION BY partition_col ORDER BY order_col ROWS_RANGE｜ROWS BETWEEN StartFrameBound AND EndFrameBound)
</pre></div>
</div>
<p>Among them, the most basic and indispensable grammatical elements include：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span> <span class="pre">partition_col</span></code>: Indicates that the window is in accordance with<code class="docutils literal notranslate"><span class="pre">partition_col</span></code>column grouping</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">order_col</span></code>: Indicates that the window is in accordance with<code class="docutils literal notranslate"><span class="pre">order_col</span></code>sorting columns</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROWS_RANGE</span></code>: Indicates that the window slides by time；<code class="docutils literal notranslate"><span class="pre">ROWS</span></code> Indicates that the window type is sliding by the number of bars</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StartFrameBound</span></code>: Represents the upper bound of the window. In OpenMLDB, we can generally define the upper bound of the window as:</p></li>
<li><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span></code>: No upper bound.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_expression</span> <span class="pre">PRECEDING</span></code>: If it is a time window, you can define a time offset. For example, ‘30d predicting’ means that the upper bound of the window is the time of the current line - 30 days.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">PRECEDING</span></code>: If it is the number of bars window, you can define the number of bars offset. For example, ‘100 predicting’ indicates the first 100 lines of the current line whose upper bound is.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EndFrameBound</span></code>: Represents the lower bound of the time window. In OpenMLDB, we can generally define the lower bound of the window as:</p></li>
<li><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CURRENT</span> <span class="pre">ROW</span></code>： Current row</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_expression</span> <span class="pre">PRECEDING</span></code>: A certain time offset, such as’ 1D forecasting ‘. This indicates that the lower bound of the window is the time of the current line - 1 day.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">PRECEDING</span></code>: If it is the number of bars window, you can define the number of bars offset. For example,<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">PRECEDING</span></code> represents the first row of the current row whose upper bound of the window is.</p></li>
</ul>
</li>
<li><p>When configuring the upper and lower boundaries of the window, please note:</p></li>
<li><ul>
<li><p>At present, OpenMLDB cannot support the time after the current row as the upper and lower bounds. For example,<code class="docutils literal notranslate"><span class="pre">1d</span> <span class="pre">FOLLOWING</span></code>. In other words, we can only deal with the historical time window. This also basically meets most of the application scenarios of Feature Engineering.</p></li>
<li><p>Lower bound time of OpenMLDB must be &gt; = Upper bound time</p></li>
<li><p>The number of lower bound entries of OpenMLDB must be &lt; = The number of upper bound entries</p></li>
</ul>
</li>
</ul>
<p>For more syntax and features, please refer to <a class="reference external" href="http://docs-cn.openmldb.ai/2620896">OpenMLDB window reference manual</a></p>
<p><img alt="img" src="../_images/table_t1.jpg" /></p>
<p>The following example shows that for the transaction table t1 shown above, we define two time windows and two number windows. The window of each sample line is by user ID (<code class="docutils literal notranslate"><span class="pre">uid</span></code>) grouping and by the transaction time (<code class="docutils literal notranslate"><span class="pre">trans_time</span></code>) sorting. Note that the following window definitions are not a completed SQL. We will add aggregate functions later to complete runnable SQL.</p>
<ul class="simple">
<li><p>w1d: User most recent window</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- The window of the user&#39;s most recent day contains the data lines from the current line to the most recent day</span>
<span class="n">window</span><span class="w"> </span><span class="n">w1d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>The w1d window of sample 9 contains three rows of data. Samples 6, 8 and 9 respectively. These three pieces of data fall within the time window of sample 9 [2022-02-07 12:00:00, 2022-02-08 12:00:00]。</p>
<ul class="simple">
<li><p>w1d_10d: User’s windows 1 day ago and the last 10 days</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- The window of user 1d ~ 10d contains data lines 1 day ago and within 10 days</span>
<span class="n">window</span><span class="w"> </span><span class="n">w1d_10d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">10</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">1</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>w1d_10d of sample 9 window contains three rows of data. Samples 1, 3 and 4 respectively. These three pieces of data fall within the time window of sample 9[2022-01-29 12:00:00, 2022-02-07 12:00:00]。</p>
<ul class="simple">
<li><p>w0_1: User’s last 0 ~ 1 line window</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- The last line window of the user, including the previous line and the current line</span>
<span class="n">window</span><span class="w"> </span><span class="n">w0_1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>w0_1 of sample 10 window contains 2 rows of data. Sample 7 and sample 10, respectively。</p>
<ul class="simple">
<li><p>w2_10: User’s last 2 ~ 10 lines of window</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- The last 2 ~ 10 lines of windows of the user, including the first 2 ~ 10 lines</span>
<span class="n">window</span><span class="w"> </span><span class="n">w2_10</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">PRECEDING</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>w2_10 of sample 10 window contains 2 rows of data. Sample 2 and sample 5, respectively.</p>
</section>
<section id="step-2-multi-line-aggregate-function-processing">
<h3>3.3.2. Step 2: Multi-line Aggregate Function Processing<a class="headerlink" href="#step-2-multi-line-aggregate-function-processing" title="Permalink to this headline">#</a></h3>
<p>After defining the time window, we can calculate the multi-line aggregate function in the time window.</p>
<p><strong>Simple Aggregation Statistics</strong></p>
<p>Aggregate functions are currently supported with examples such as：<code class="docutils literal notranslate"><span class="pre">count()</span></code>, <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">avg()</span></code></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Total transaction amount in the last 30 days</span>
<span class="k">sum</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_sum_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Maximum transaction amount in the last 30 days</span>
<span class="k">max</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_max_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Average single transaction amount in the last 30 days</span>
<span class="k">avg</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_avg_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Total number of transactions in the last 30 days</span>
<span class="k">count</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_count_trans_amt</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Aggregate Statistics after Filtering</strong></p>
<p>First, filter the data set according to the conditions, and then make simple statistics. Example of the function shape of <code class="docutils literal notranslate"><span class="pre">xxx_where</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">xxx_where</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">filter_condition</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">col</span></code>：The columns that participate in the aggregation calculation.</p></li>
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">filter_condition</span></code>：Filter condition expression of data.</p></li>
</ul>
<p>Currently supported with <code class="docutils literal notranslate"><span class="pre">_where</span></code> aggregate functions of type are:<code class="docutils literal notranslate"><span class="pre">count_where</span></code>, <code class="docutils literal notranslate"><span class="pre">sum_where</span></code>, <code class="docutils literal notranslate"><span class="pre">avg_where</span></code>, <code class="docutils literal notranslate"><span class="pre">max_where</span></code>, <code class="docutils literal notranslate"><span class="pre">min_where</span></code> .</p>
<p>Relevant examples are as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Total POS transaction amount in the last 30 days</span>
<span class="n">sum_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_sum_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Maximum POS transaction amount in the last 30 days</span>
<span class="n">max_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_max_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Average single POS transaction amount in the last 30 days</span>
<span class="n">avg_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_avg_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Total number of POS transactions in the last 30 days</span>
<span class="n">count_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_count_pos_trans_amt</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Aggregate Statistics after Grouping</strong></p>
<p>The data set is grouped according to a column, and then grouped for statistics. The statistical results are saved as <code class="docutils literal notranslate"><span class="pre">&quot;k1:v1,k2:v2,k3:v3&quot;</span></code> type of String.</p>
<p>Function shape of <code class="docutils literal notranslate"><span class="pre">xxx_cate</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">xxx_cate</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">cate</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">col</span></code>：The columns that participate in the aggregation calculation.</p></li>
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">cate</span></code>：Grouping column.</p></li>
</ul>
<p>Currently supported with _cate, the aggregate function of suffix is:<code class="docutils literal notranslate"><span class="pre">count_cate</span></code>, <code class="docutils literal notranslate"><span class="pre">sum_cate</span></code>, <code class="docutils literal notranslate"><span class="pre">avg_cate</span></code>, <code class="docutils literal notranslate"><span class="pre">max_cate</span></code>, <code class="docutils literal notranslate"><span class="pre">min_cate</span></code></p>
<p>Relevant examples are as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Total number of transactions in each city in the last 30 days, &quot;beijing:10,shanghai:3&quot;</span>
<span class="n">count_cate</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_count_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Total transaction volume of each city in the last 30 days, &quot;beijing:100,shanghai:30&quot;</span>
<span class="n">sum_cate</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_sum_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Average transaction volume of each city in the last 30 days, &quot;beijing:10,shanghai:10&quot;</span>
<span class="n">avg_cate</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_avg_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Maximum transaction volume of each city in the last 30 days, &quot;beijing:30,shanghai:15&quot;</span>
<span class="n">max_cate</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_max_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Minimum transaction volume of each city in the last 30 days, &quot;beijing:5,shanghai:5&quot;</span>
<span class="n">min_cate</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_max_trans_amt</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Group Aggregation Statistics after Filtering</strong></p>
<p>First, filter the window according to conditions. Then, group the data set according to a column, and then group statistics. The statistical results are saved as<code class="docutils literal notranslate"><span class="pre">&quot;k1:v1,k2:v2,k3:v3&quot;</span></code>type of String</p>
<p>Function shape of <code class="docutils literal notranslate"><span class="pre">xxx_cate_where</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>xxx_cate_where(col, filter_condition, cate) over w
</pre></div>
</div>
<ul class="simple">
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">col</span></code>：The columns that participate in the aggregation calculation.</p></li>
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">filter_condition</span></code>：Filter condition expression of data.</p></li>
<li><p>Parameter <code class="docutils literal notranslate"><span class="pre">cate</span></code>: Group columns.</p></li>
</ul>
<p>Currently, the supported statistical functions of grouping and aggregation after filtering are:<code class="docutils literal notranslate"><span class="pre">count_cate_where</span></code>, <code class="docutils literal notranslate"><span class="pre">sum_cate_where</span></code>, <code class="docutils literal notranslate"><span class="pre">avg_cate_where</span></code>, <code class="docutils literal notranslate"><span class="pre">max_cate_where</span></code>, <code class="docutils literal notranslate"><span class="pre">min_cate_where</span></code></p>
<p>Relevant examples are as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Number of POS transactions in each city in the last 30 days, &quot;beijing:5,shanghai:2&quot;</span>
<span class="n">count_cate_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_count_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Total POS transactions by city in the last 30 days, &quot;beijing:60,shanghai:25&quot;</span>
<span class="n">sum_cate_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_sum_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Average POS transaction volume of each city in the last 30 days, &quot;beijing:12,shanghai:12.5&quot;</span>
<span class="n">avg_cate_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_avg_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Maximum POS turnover of each city in the last 30 days, &quot;beijing:30,shanghai:15&quot;</span>
<span class="n">max_cate_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_count_pos_trans_amt</span><span class="p">,</span><span class="w"></span>
<span class="c1">-- Minimum POS transaction volume of each city in the last 30 days, &quot;beijing:5,shanghai:10&quot;</span>
<span class="n">min_cate_where</span><span class="p">(</span><span class="n">trans_amt</span><span class="p">,</span><span class="w"> </span><span class="n">trans_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;POS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">w30d_city_count_pos_trans_amt</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Frequency Statistics by Type Column</strong></p>
<p>Usually, we make frequency statistics for type characteristics. For example, we may need to count the types with the highest frequency and the frequency proportion of the types with the highest frequency in various categories.</p>
<p>The features of Top ratio <code class="docutils literal notranslate"><span class="pre">fz_top1_ratio</span></code>：Find the proportion of the maximum count of a category count in the window to the total data of the window.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Proportion of transactions in cities with the largest number of transactions in the last 30 days</span>
<span class="n">fz_top1_ratio</span><span class="p">(</span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">top_city_ratio</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The feature of Top N <code class="docutils literal notranslate"><span class="pre">fz_topn_frequency(col,</span> <span class="pre">top_n)</span></code>: Find the N categories with the highest classification frequency in the window</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="c1">-- Two cities with the largest number of transactions in the last 30 days, &quot;beijing,shanghai&quot;</span>
<span class="n">fz_topn_frequency</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">top_city_ratio</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span>
<span class="n">window</span><span class="w"> </span><span class="n">w30d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">trans_time</span><span class="w"> </span><span class="n">ROWS_RANGE</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="extended-reading-and-the-next-preview">
<h2>4. Extended Reading and the Next Preview<a class="headerlink" href="#extended-reading-and-the-next-preview" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://zhuanlan.zhihu.com/p/462559609">Open-source Machine Learning Database OpenMLDB v0.4.0 Product Introduction</a></p></li>
<li><p>Want to quickly try the OpenMLDB to start writing feature calculation scripts? Let’s take a look at <a class="reference external" href="http://docs-cn.openmldb.ai/2620852">OpenMLDB Quick Start</a></p></li>
<li><p>Complete SQL syntax reference <a class="reference external" href="http://docs-cn.openmldb.ai/2620876">China Mirror Site</a>, <a class="reference external" href="https://docs.openmldb.ai/">International Site</a></p></li>
<li><p>The second part of this series of tutorials: <a class="reference external" href="https://zhuanlan.zhihu.com/p/472080344">4PD Developer Community: In Simple Terms, Feature Engineering – A Practical Guide based on OpenMLDB (Part 2)</a></p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="standalone_vs_cluster.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Cluster vs. Standalone Versions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tutorial_sql_2.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Guidelines for Feature Engineering Development (Part 2)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By OpenMLDB<br/>
  
      &copy; Copyright 2022, OpenMLDB.<br/>
    Last updated on Aug 27, 2022, 3:54:48 PM.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>